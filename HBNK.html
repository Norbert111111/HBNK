<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@electro-elites</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="stylesheet" href="style2.css" />
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-database-compat.js"></script>
</head>
<body>
   <!-- Version desktop -->
   <div class="main-wrapper">
      <h1 class="hide-on-mobile" style="color: #2343e4;">RESEAU 4.0 DE TRANSPORT √âLECTRIQUE INTELLIGENT Bas√©e Sur l'IA(AI)  EN R.D.C </h1>
      
      <h2 class="hide-on-mobile" style="color: #2343e4;">              @HBNK.AGK                                                      </h2>

  
  <div class="image-container">
   <img class="hide-on-mobile image-placeholder" src="images/logo1.jpg" alt="Logo1" style="height: 100px; width: 100px; border-radius: 50%; object-fit: cover;">

    <h3 class="title-desktop" style="color: rgb(76, 80, 198); font-size: 22px; margin-top: 10px;">
      <br>INTERFACE DE CONTR√îLE ET D'AFFICHAGE DES DONN√âES DU RESEAU </h3>

    <img class="hide-on-mobile image-placeholder" src="images/logo1.jpg" alt="Logo1" style="height: 100px; width: 100px; border-radius: 50%; object-fit: cover;">

  </div>
  <!-- Version mobile uniquement -->
      
    <div class="title-mobile-wrapper">
     <img src="images/logo1.jpg" alt="Logo1" class="image-placeholder" style="height: 100px;">
       <div class="text-block">
         <span>RESEAU DE TRANSPORT ELEC</span>
        <span>4.0 INTELLIGENT</span>
      </div>
      <h5  style="color: #1408f4;">
    </div>
    <p class="mobile-only">INTERFACE DE CONTR√îLE</p>
      
   


  <div class="table-wrapper">
  <table>
    <tr class="title-row">
      <th style="color: rgb(78, 76, 222);"colspan="7">Les Donn√©es de la ligne</th>
    </tr>
    <tr>
      <th style="color: rgb(68, 68, 227);">Courant</th>
      <th style="color: rgb(58, 58, 220);">Tension</th>
      <th style="color: rgb(70, 70, 230);">Puissance</th>
      <th style="color: rgb(71, 71, 231);">PuissanceA</th>
      <th style="color: rgb(74, 74, 232);">Temp√©rature</th>
      <th style="color: rgb(68, 68, 227);">Humidit√©</th>
      <th style="color: rgb(70, 70, 230);"> cosœÅ</th>
    </tr>
    <tr>
      <td id="COURANT"style="color: orange;">0</td>
      <td id="DDP"style="color: orange;">0V</td>
      <td id="PUISS"style="color: orange;">0W</td>
      <td id="PUISSA"style="color: orange;">0VA</td>
      <td id="TEMP"style="color: orange;">0¬∞C</td>
      <td id="HUM"style="color: orange;">0%</td>
      <td id="Cos"style="color: orange;">0</td>
    </tr>
  </table>
  </div>

  
  <h3 style="color: rgba(64, 64, 202, 0.988);">CONTROLE ET COMMANDE DE LIGNES DE DISTRIBUTION</h3>
  
  <section class="command-section">
    <div class="station gombe">
      <h4 style="color: rgb(74, 5, 249);">D√©part GOMBE</h4>
      <button class="activate" onclick="activerGombe()">Activer</button>
      <button class="desactivate" onclick="desactiverGombe()">D√©sactiver</button>
      <p><span id="etatGombe">En attente...</span></p>
    </div>
  
    <div class="station limete">
      <h4 style="color: rgb(52, 10, 241);">D√©part LIMETE</h4>
      <button class="activate" onclick="activerLimete()">Activer</button>
      <button class="desactivate" onclick="desactiverLimete()">D√©sactiver</button>
      <p><span id="etatLimete">En attente...</span></p>
    </div>
  
    <div class="station barumbu">
      <h4 style="color: rgb(53, 10, 245);">D√©part BARUMBU</h4>
      <button class="activate" onclick="activerBarumbu()">Activer</button>
      <button class="desactivate" onclick="desactiverBarumbu()">D√©sactiver</button>
      <p><span id="etatBarumbu">En attente...</span></p>
    </div>

    <div class="station tout">
      <h4 style="color: rgb(57, 9, 248);">Tous Les D√©parts </h4>
     <button id="btnActiverTout" class="activate" onclick="activertout()">Activer Tous les D√©parts</button>

      <button class="desactivate" onclick="desactivertout()">D√©sactiver Tous Les D√©parts</button>
      <p><span id="etatd√©parts">En attente...</span></p>
    </div>
  </section>

<!-- Barre de navigation fixe -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="window.location.href='index.html'">
    <i class="fas fa-home"></i>
  </div>
  <div class="nav-item" onclick="window.location.href='HBNK.html'">
    <i class="fas fa-sliders-h"></i>
  </div>
  <div class="nav-item" onclick="window.location.href='index3.html'">
    <i class="fas fa-chart-line"></i>
  </div>
 
</div>



  <script>
    parler("Bienvenue sur l‚Äôinterface de contr√¥le et de commande du r√©seau √©lectrique intelligent en R D C.");
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyArEB0lH1tz3OOvrgKzL0cypYfMpQVgPm0",
      authDomain: "maison-iot-b0dd6.firebaseapp.com",
      databaseURL: "https://maison-iot-b0dd6-default-rtdb.firebaseio.com",
      projectId: "maison-iot-b0dd6",
      storageBucket: "maison-iot-b0dd6.appspot.com",
      messagingSenderId: "838021465845",
      appId: "1:838021465845:web:b277f02fd883b0c23627bc",
      measurementId: "G-P697GH67M1"
    };
  
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  
    let Tension = 0;
    let Courant = 0;
  
    // Mise √† jour des donn√©es capteurs
    database.ref("Data/Temperature").on("value", (snapshot) => {
      document.getElementById("TEMP").textContent = snapshot.val() + " ¬∞C";
    });
  
    database.ref("Data/hymidite").on("value", (snapshot) => {
      document.getElementById("HUM").textContent = snapshot.val() + " %";
    });
  
    database.ref("Data/Tension").on("value", (snapshot) => {
  Tension = snapshot.val();
  document.getElementById("DDP").textContent = Tension + " V";

  

  updatePower();
});
  
    database.ref("Data/Courant").on("value", (snapshot) => {
      Courant = snapshot.val();
      document.getElementById("COURANT").textContent = Courant + " A";
      updatePower();
    });
  
    function updatePower() {
      const F = 0.9;
      const puissance = Tension * Courant * F;
      const puissanceA = Tension * Courant;
  
      document.getElementById("PUISS").textContent = puissance.toFixed(2) + " W";
      document.getElementById("PUISSA").textContent = puissanceA.toFixed(2) + " VA";
      document.getElementById("Cos").textContent = F;
  
      database.ref("Data/puissance").set(puissance);
      database.ref("Data/puissanceA").set(puissanceA);
    }
      let modeSilencieux = false; // Pour contr√¥ler si on doit parler ou non
// Fonction de synth√®se vocale
function parler(message) {
  const utterance = new SpeechSynthesisUtterance(message);
  utterance.lang = "fr-FR"; // Fran√ßais
  speechSynthesis.speak(utterance);
}

    // Fonction pour activer visuellement une station
function activerStation(station) {
  const activateBtn = document.querySelector(`.station.${station} .activate`);
  activateBtn.classList.add("active");
}

// Fonction pour d√©sactiver visuellement une station
function desactiverStation(station) {
  const activateBtn = document.querySelector(`.station.${station} .activate`);
  activateBtn.classList.remove("active");
}

// Fonctions pour chaque d√©part
function activerGombe() {
  database.ref("Depars/Depart_GOMBE").set(1); // valeurs num√©riques
  activerStation("gombe");
  if (!modeSilencieux)parler("Le d√©part pour la commune de la Gomb√© ; est activ√© ");
}

function desactiverGombe() {
  database.ref("Depars/Depart_GOMBE").set(0);
  desactiverStation("gombe");
  if (!modeSilencieux)parler("Le d√©part pour la commune de la Gomb√© ; est d√©sactiv√© ");
}

database.ref("Depars/Depart_GOMBE").on("value", (snapshot) => {
  const etat = snapshot.val();
  const etatGombeElem = document.getElementById("etatGombe");
  const activateBtn = document.querySelector(".station.gombe .activate");
  
  etatGombeElem.textContent = (etat == 1) ? "GOMBE est Activ√©" : "GOMBE est D√©sactiv√©";
  etatGombeElem.style.color = (etat == 1) ? "blue" : "red"; // couleur du texte
  // ou pour changer la couleur de fond √† la place :
  // etatGombeElem.style.backgroundColor = (etat == 1) ? "yellow" : "green";
  
  if (etat == 1) {
    activateBtn.classList.add("active");
  } else {
    activateBtn.classList.remove("active");
  }

  verifierEtatGlobal();
});

function activerLimete() {
  database.ref("Depars/Depart_LIMETE").set(1);
  activerStation("limete");
  if (!modeSilencieux)parler("Le d√©part pour la commune de Lim√©t√©  ; est activ√© ");
}

function desactiverLimete() {
  database.ref("Depars/Depart_LIMETE").set(0);
  desactiverStation("limete");
  if (!modeSilencieux)parler("Le d√©part pour la commune de Lim√©t√©  ; est d√©sactiv√© ");
}

database.ref("Depars/Depart_LIMETE").on("value", (snapshot) => {
  const etat = snapshot.val();
  const etatLimeteElem = document.getElementById("etatLimete");
  const activateBtn = document.querySelector(".station.limete .activate");

  etatLimeteElem.textContent = (etat == 1) ? "LIMETE est Activ√©" : "LIMETE est D√©sactiv√©";
  etatLimeteElem.style.color = (etat == 1) ? "blue" : "red"; // couleur du texte

  if (etat == 1) {
    activateBtn.classList.add("active");
  } else {
    activateBtn.classList.remove("active");
  }
  verifierEtatGlobal();
});

function activerBarumbu() {
  database.ref("Depars/Depart_BARUMBU").set(1);
  activerStation("barumbu");
  if (!modeSilencieux)parler("Le d√©part pour la commune de Baroumbou ; est activ√© ");
}

function desactiverBarumbu() {
  database.ref("Depars/Depart_BARUMBU").set(0);
  desactiverStation("barumbu");
  if (!modeSilencieux)parler("Le d√©part pour la commune de Baroumbou; est d√©sactiv√© ");
}

database.ref("Depars/Depart_BARUMBU").on("value", (snapshot) => {
  const etat = snapshot.val();
  const etatBarumbuElem = document.getElementById("etatBarumbu");
  const activateBtn = document.querySelector(".station.barumbu .activate");

  etatBarumbuElem.textContent = (etat == 1) ? "BARUMBU est Activ√©" : "BARUMBU est D√©sactiv√©";
  etatBarumbuElem.style.color = (etat == 1) ? "blue" : "red"; // couleur du texte

  if (etat == 1) {
    activateBtn.classList.add("active");
  } else {
    activateBtn.classList.remove("active");
  }
  verifierEtatGlobal();
});

// Activer tous les d√©parts
function activertout() {
  modeSilencieux = true;
  activerGombe();
  activerLimete();
  activerBarumbu();
  modeSilencieux = false;

  database.ref("Depars/Depart_TOUT").set(1);
  

  document.querySelectorAll("button.activate").forEach(btn => {
    btn.classList.add("active");
    
  });
  // Parler lorsque tous les d√©parts sont activ√©s
  parler("Tous les d√©parts sont activ√©s");
}

// D√©sactiver tous les d√©parts
function desactivertout() {
   modeSilencieux = true;
  desactiverGombe();
  desactiverLimete();
  desactiverBarumbu();
   modeSilencieux = false;

  database.ref("Depars/Depart_TOUT").set(0);
  

  document.querySelectorAll("button.activate").forEach(btn => {
    btn.classList.remove("active");
  });
   if (Tension > 140) {

   parler("Tous les d√©parts sont d√©sactiv√©s");
  }
   // Parler lorsque tous les d√©parts sont activ√©s
  //parler("Tous les d√©parts sont d√©sactiv√©s");
}

// V√©rification de l'√©tat global de tous les d√©parts
function verifierEtatGlobal() {
  database.ref("Depars").once("value").then((snapshot) => {
    const data = snapshot.val();
    const gombe = data.Depart_GOMBE;
    const limete = data.Depart_LIMETE;
    const barumbu = data.Depart_BARUMBU;
    const tout = data.Depart_TOUT;

    const etatGlobalElem = document.getElementById("etatd√©parts");
    const btnActiverTout = document.getElementById("btnActiverTout");

    let texteGlobal = "";

  if (gombe == 1 && limete == 1 && barumbu == 1) {
    
  texteGlobal = "Tous les D√©parts sont Activ√©s";
  etatGlobalElem.style.color = "blue";
  // rendre le bouton "Activer tout" jaune (classe active)
  btnActiverTout.classList.add("active");
  
  

} else if (gombe == 0 && limete == 0 && barumbu == 0) {
  texteGlobal = "Tous les D√©parts sont D√©sactiv√©s";
  etatGlobalElem.style.color = "red";
  // retirer la classe "active" => vert par d√©faut
 btnActiverTout.classList.remove("active");

  }
else {
  texteGlobal = "Tous les D√©parts ne sont pas Activ√©s";
  etatGlobalElem.style.color = "green";
  btnActiverTout.classList.remove("active");
  //parler("Tous les d√©parts des communes; ne sont Activ√©s  ");
}

   etatGlobalElem.textContent = texteGlobal;
  });
}

// Rendre les fonctions accessibles globalement
window.activerGombe = activerGombe;
window.desactiverGombe = desactiverGombe;
window.activerLimete = activerLimete;
window.desactiverLimete = desactiverLimete;
window.activerBarumbu = activerBarumbu;
window.desactiverBarumbu = desactiverBarumbu;
window.activertout = activertout;
window.desactivertout = desactivertout;



// ‚úÖ Fonction pour faire parler le syst√®me
function parler(message) {
  const synthese = window.speechSynthesis;
  const voix = new SpeechSynthesisUtterance(message);
  voix.lang = "fr-FR";
  synthese.speak(voix);
}

let compteurIA = 0;

// ‚úÖ Fonction principale qui lit les mesures, analyse et parle
function annoncerMesuresEtPrediction() {
  const courant = parseFloat(document.getElementById("COURANT").textContent);
  const tension = parseFloat(document.getElementById("DDP").textContent);
  const puissancee = parseFloat(document.getElementById("PUISS").textContent);
  const puissanceApparente = parseFloat(document.getElementById("PUISSA").textContent);
  const temperature = parseFloat(document.getElementById("TEMP").textContent);
  const humidite = parseFloat(document.getElementById("HUM").textContent);
  const cosPhi = parseFloat(document.getElementById("Cos").textContent);


  // üî¢ Incr√©ment du compteur pour limiter la fr√©quence d'annonce
  compteurIA++;
  if (compteurIA < 13) return; // Exemple : toutes les 2 minutes si intervalle = 5 sec
  compteurIA = 0;

  // üîç Annonce des mesures actuelles
  let texteMesures =
    "Voici les mesures actuelles de la pr√©diction de l'√©tat du syst√®me : " +
    `Le Courant est de  : ${courant} emp√®re${courant > 1 ? "s" : ""}, ` +
    `La Tension est de : ${tension} volt${tension > 1 ? "s" : ""}, ` +
    `La Puissance active est de : ${puissancee} watt${puissancee > 1 ? "s" : ""}, ` +
    `La Puissance apparente est de : ${puissanceApparente} volt-emp√®re${puissanceApparente > 1 ? "s" : ""}, ` +
    `La Temp√©rature est de: ${temperature} degr√©${temperature > 1 ? "s" : ""} Celsius, ` +
    `L'Humidit√© est de : ${humidite}%, ` +
    `et le Facteur de puissance est de : ${cosPhi.toFixed(2)}.`;

  parler(texteMesures);

  // üìä Analyse intelligente
  let estNormal = true;
  let anomalies = [];

  if ( courant > 30) {
    estNormal = false;
    anomalies.push("le courant est anormal");
  }

  if (tension < 200 || tension > 250) {
    estNormal = false;
    anomalies.push("la tension est hors de la plage normale");
  }

  if (puissancee > 10000) {
    estNormal = false;
    anomalies.push("la puissance d√©passe 10 000 watts");
  }

  if (temperature < 10 || temperature > 45) {
    estNormal = false;
    anomalies.push("la temp√©rature est hors norme");
  }

  if (humidite < 10 || humidite > 80) {
    estNormal = false;
    anomalies.push("le taux d'humidit√© est critique");
  }

  if (cosPhi < 0.7 || cosPhi > 1.0) {
    estNormal = false;
    anomalies.push("le facteur de puissance est inad√©quat");
  }

  // üîî R√©sultat de l‚Äôanalyse pr√©dictive
  if (estNormal) {
    parler("Analyse de la pr√©diction IA : toutes les donn√©es sont normales. Le syst√®me fonctionne correctement.");
  } else {
    parler("Attention. Analyse de la pr√©diction IA : des anomalies ont √©t√© d√©tect√©es apres l'Analyse de donn√©es. " + anomalies.join(", ") + ".");
  }

   // üì£ Annonce vocale de l‚Äô√©tat des d√©parts depuis Firebase
database.ref("Depars").once("value").then((snapshot) => {
  const data = snapshot.val();

  const etats = {
    Gomb√©: data.Depart_GOMBE,
    Lim√©t√©: data.Depart_LIMETE,
    Baroumbou: data.Depart_BARUMBU
  };

  const activ√©s = Object.entries(etats)
    .filter(([_, val]) => val == 1)
    .map(([commune, _]) => commune);

  const d√©sactiv√©s = Object.entries(etats)
    .filter(([_, val]) => val == 0)
    .map(([commune, _]) => commune);

  // üîä Annoncer les communes activ√©es
  if (activ√©s.length === 0) {
    parler("Tous les d√©parts sont d√©sactiv√©s.");
  } else if (activ√©s.length === 3) {
    parler("Tous les d√©parts sont activ√©s.");
  } else {
    const phraseActiv√©s = activ√©s.map(c => `la commune de ${c}`).join(", ");
    parler("D√©parts activ√©s : " + phraseActiv√©s + ".");
  }

  // üîä Annoncer les communes d√©sactiv√©es
  if (d√©sactiv√©s.length > 0 && d√©sactiv√©s.length < 3) {
    const phraseD√©sactiv√©s = d√©sactiv√©s.map(c => `la commune de ${c}`).join(", ");
    parler("d√©parts d√©sactiv√©s  : " + phraseD√©sactiv√©s + ".");
  }
});

}

// ‚è±Ô∏è Ex√©cution p√©riodique toutes les 5 secondes
setInterval(annoncerMesuresEtPrediction, 5000); // Ex√©cute chaque 5 secondes
 
  
    

    // Fonction utilitaire pour g√©n√©rer une valeur flottante al√©atoire entre min et max
function getRandomFloat(min, max) {
  return Math.random() * (max - min) + min;
}

// Fonction pour calculer et simuler le courant selon les d√©parts activ√©s
function simulerVariationCourant() {
  database.ref("Depars").once("value").then((snapshot) => {
    const data = snapshot.val();

    const actifs = [
      data.Depart_GOMBE,
      data.Depart_LIMETE,
      data.Depart_BARUMBU
    ];

    const nbActifs = actifs.filter(etat => etat === 1).length;

    let courantSimul√© = 0;

    if (nbActifs === 0) {
      courantSimul√© = 0.00;
    } else if (nbActifs === 1) {
      courantSimul√© = getRandomFloat(4.00, 4.09);
    } else if (nbActifs === 2) {
      courantSimul√© = getRandomFloat(8.00, 8.18);
    } else if (nbActifs === 3) {
      courantSimul√© = getRandomFloat(12.00, 12.36);
    }

    // Mettre √† jour Firebase avec la valeur simul√©e du courant
    database.ref("Data/Courant").set(parseFloat(courantSimul√©.toFixed(2)));
  });
}

// Rafra√Æchir la valeur du courant toutes les 3 secondes
setInterval(simulerVariationCourant, 2000);








/*const db = firebase.database();
const dataRef = db.ref("Data");
const tensionRef = dataRef.child("Tension");

let ancienneTension = null;
let timeoutStagnation = null;

// Fonction pour r√©initialiser les donn√©es
function resetDonneesFirebase() {
  console.warn("‚ö†Ô∏è Tension inchang√©e pendant 2 minutes. Donn√©es r√©initialis√©es.");
  dataRef.update({
    Tension: 0,
    Courant: 0,
    Temperature: 0,
    hymidite: 0
  });
  timeoutStagnation = null;
}

// Fonction de surveillance de la tension
function surveillerVariationTension() {
  tensionRef.on("value", (snapshot) => {
    const tensionActuelle = snapshot.val();
    if (tensionActuelle == null) return;

    // Si la tension change ‚Üí r√©initialiser le timer
    if (ancienneTension !== null && tensionActuelle !== ancienneTension) {
      clearTimeout(timeoutStagnation);
      timeoutStagnation = setTimeout(resetDonneesFirebase, 1 * 60 * 1000); // 2 minutes
    }

    // Si la tension est stable (y compris 0) ‚Üí lancer ou maintenir le timer
    if (ancienneTension === null || tensionActuelle === ancienneTension) {
      if (!timeoutStagnation) {
        timeoutStagnation = setTimeout(resetDonneesFirebase, 1 * 60 * 1000); // 2 minutes
      }
    }

    ancienneTension = tensionActuelle;
  });
}

// D√©marrer la surveillance
surveillerVariationTension();
*/


setInterval(() => {
  if (Tension < 140) {
    console.warn("‚ö†Ô∏è V√©rification p√©riodique : tension inf√©rieure √† 140V, d√©sactivation des d√©parts.");
    desactivertout();
    //parler("Attention. La tension est inf√©rieure √† 140 volts. Tous les d√©parts sont d√©sactiv√©s.");
  }
}, 5);  // toutes les 5 secondes 


    
  </script>
</body>
</html>  